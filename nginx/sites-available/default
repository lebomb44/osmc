##
# You should look at the following URL's in order to grasp a solid understanding
# of Nginx configuration files in order to fully unleash the power of Nginx.
# http://wiki.nginx.org/Pitfalls
# http://wiki.nginx.org/QuickStart
# http://wiki.nginx.org/Configuration
#
# Generally, you will want to move this file somewhere, and start with a clean
# file but keep this around for reference. Or just disable in sites-enabled.
#
# Please see /usr/share/doc/nginx-doc/examples/ for more detailed examples.
##

# Default server configuration
#

server {
	listen 80 default_server;
	server_tokens off;
	more_set_headers "Server: none";
        auth_basic "Restricted";                                              
        auth_basic_user_file /etc/nginx/.htpasswd;
	location / {
		root /etc/nginx/html;
	}

	# Nginx
	location /nginx {
		stub_status on;
	}

	# ShellInABox
	location /shell {
		proxy_pass http://localhost:4200/;
	}

	# Onwcloud
	location /owncloud {
		auth_basic off;
		proxy_pass http://localhost:8081;
	}

	# Files
        location /files {
                autoindex on;
                alias /home/osmc;
        }

	# Deluge
        location /deluge {
                proxy_pass http://192.168.100.2:8112/;
                proxy_set_header  X-Deluge-Base "/deluge/";
        }

	# Transmission
        location /transmission {
                proxy_http_version 1.1;
                proxy_set_header Connection "";
                proxy_pass_header X-Transmission-Session-Id;
                proxy_pass http://192.168.100.2:9091;
        }

	# Kodi Web interface
        location /addons {                                   
                proxy_pass http://localhost:8080;       
        }       
        location /jsonrpc {         
                proxy_pass http://localhost:8080; 
        }                                              
        location /image {         
                proxy_pass http://localhost:8080; 
        }                                              
        location /vfs {         
                proxy_pass http://localhost:8080; 
        }

        # Bourdilot                                                                                                                                                                   
        location ~ ^/bourdilot(/.*)?$ {
		resolver_timeout 30s;
		resolver 192.168.10.1 valid=30s;
		set $bourdilot_upstream "bourdilot.no-ip.org";
                proxy_pass http://$bourdilot_upstream$1$is_args$args;
        }

	# Freebox
	location /freebox/ {
		proxy_pass http://192.168.10.1/;
	}
	location /api/v3 {
		proxy_pass http://192.168.10.1;
	}


	location /rpicam {
		root /var/www;
		index index.php index.html index.htm;
		try_files $uri $uri/ /index.html;
	}
	location ~ [^/rpicam]\.php(/|$) {
		root /var/www;
		index index.php index.html index.htm;
		fastcgi_split_path_info ^(.+?\.php)(/.*)$;
		if (!-f $document_root$fastcgi_script_name) {
			return 404;
		}
		fastcgi_pass unix:/var/run/php5-fpm.sock;
		fastcgi_index index.php;
		include fastcgi_params;
		fastcgi_param SCRIPT_FILENAME $document_root/$fastcgi_script_name;
		#auth_basic "Off";
		#auth_basic_user_file /usr/local/.htpasswd;
	}
	location ~ /rpicam\.ht {
		root /var/www;
		index index.php index.html index.htm;
		deny all;
	}

}

